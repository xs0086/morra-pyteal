{"ast":null,"code":"import { Buffer } from 'buffer';\nimport base32 from 'hi-base32';\nimport * as address from './encoding/address';\nimport * as encoding from './encoding/encoding';\nimport * as nacl from './nacl/naclWrappers';\nimport * as utils from './utils/utils';\nimport { translateBoxReferences } from './boxStorage';\nimport { TransactionType, isTransactionType } from './types/transactions/base';\nconst ALGORAND_TRANSACTION_LENGTH = 52;\nexport const ALGORAND_MIN_TX_FEE = 1000; // version v5\nconst ALGORAND_TRANSACTION_LEASE_LENGTH = 32;\nconst ALGORAND_MAX_ASSET_DECIMALS = 19;\nconst NUM_ADDL_BYTES_AFTER_SIGNING = 75; // NUM_ADDL_BYTES_AFTER_SIGNING is the number of bytes added to a txn after signing it\nconst ALGORAND_TRANSACTION_LEASE_LABEL_LENGTH = 5;\nconst ALGORAND_TRANSACTION_ADDRESS_LENGTH = 32;\nconst ALGORAND_TRANSACTION_REKEY_LABEL_LENGTH = 5;\nconst ASSET_METADATA_HASH_LENGTH = 32;\nconst KEYREG_VOTE_KEY_LENGTH = 32;\nconst KEYREG_SELECTION_KEY_LENGTH = 32;\nconst KEYREG_STATE_PROOF_KEY_LENGTH = 64;\nfunction getKeyregKey(input, inputName, length) {\n  if (input == null) {\n    return undefined;\n  }\n  let inputAsBuffer;\n  if (typeof input === 'string') {\n    inputAsBuffer = Buffer.from(input, 'base64');\n  } else if (input.constructor === Uint8Array) {\n    inputAsBuffer = Buffer.from(input);\n  } else if (Buffer.isBuffer(input)) {\n    inputAsBuffer = input;\n  }\n  if (inputAsBuffer == null || inputAsBuffer.byteLength !== length) {\n    throw Error(`${inputName} must be a ${length} byte Uint8Array or Buffer or base64 string.`);\n  }\n  return inputAsBuffer;\n}\n/**\n * Transaction enables construction of Algorand transactions\n * */\nexport class Transaction {\n  constructor(_ref) {\n    let {\n      ...transaction\n    } = _ref;\n    this.name = 'Transaction';\n    this.tag = Buffer.from('TX');\n    // Populate defaults\n    /* eslint-disable no-param-reassign */\n    const defaults = {\n      type: TransactionType.pay,\n      flatFee: false,\n      nonParticipation: false\n    };\n    // Default type\n    if (typeof transaction.type === 'undefined') {\n      transaction.type = defaults.type;\n    }\n    // Default flatFee\n    if (typeof transaction.flatFee === 'undefined') {\n      transaction.flatFee = defaults.flatFee;\n    }\n    // Default nonParticipation\n    if (transaction.type === TransactionType.keyreg && typeof transaction.voteKey !== 'undefined' && typeof transaction.nonParticipation === 'undefined') {\n      transaction.nonParticipation = defaults.nonParticipation;\n    }\n    /* eslint-enable no-param-reassign */\n    // Move suggested parameters from its object to inline\n    if (transaction.suggestedParams !== undefined) {\n      // Create a temporary reference to the transaction object that has params inline and also as a suggested params object\n      //   - Helpful for moving params from named object to inline\n      const reference = transaction;\n      reference.genesisHash = reference.suggestedParams.genesisHash;\n      reference.fee = reference.suggestedParams.fee;\n      if (reference.suggestedParams.flatFee !== undefined) reference.flatFee = reference.suggestedParams.flatFee;\n      reference.firstRound = reference.suggestedParams.firstRound;\n      reference.lastRound = reference.suggestedParams.lastRound;\n      reference.genesisID = reference.suggestedParams.genesisID;\n    }\n    // At this point all suggestedParams have been moved to be inline, so we can reassign the transaction object type\n    // to one which is more useful as we prepare properties for storing\n    const txn = transaction;\n    txn.from = address.decodeAddress(txn.from);\n    if (txn.to !== undefined) txn.to = address.decodeAddress(txn.to);\n    if (txn.closeRemainderTo !== undefined) txn.closeRemainderTo = address.decodeAddress(txn.closeRemainderTo);\n    if (txn.assetManager !== undefined) txn.assetManager = address.decodeAddress(txn.assetManager);\n    if (txn.assetReserve !== undefined) txn.assetReserve = address.decodeAddress(txn.assetReserve);\n    if (txn.assetFreeze !== undefined) txn.assetFreeze = address.decodeAddress(txn.assetFreeze);\n    if (txn.assetClawback !== undefined) txn.assetClawback = address.decodeAddress(txn.assetClawback);\n    if (txn.assetRevocationTarget !== undefined) txn.assetRevocationTarget = address.decodeAddress(txn.assetRevocationTarget);\n    if (txn.freezeAccount !== undefined) txn.freezeAccount = address.decodeAddress(txn.freezeAccount);\n    if (txn.reKeyTo !== undefined) txn.reKeyTo = address.decodeAddress(txn.reKeyTo);\n    if (txn.genesisHash === undefined) throw Error('genesis hash must be specified and in a base64 string.');\n    txn.genesisHash = Buffer.from(txn.genesisHash, 'base64');\n    if (txn.amount !== undefined && (!(Number.isSafeInteger(txn.amount) || typeof txn.amount === 'bigint' && txn.amount <= BigInt('0xffffffffffffffff')) || txn.amount < 0)) throw Error('Amount must be a positive number and smaller than 2^64-1. If the number is larger than 2^53-1, use bigint.');\n    if (!Number.isSafeInteger(txn.fee) || txn.fee < 0) throw Error('fee must be a positive number and smaller than 2^53-1');\n    if (!Number.isSafeInteger(txn.firstRound) || txn.firstRound < 0) throw Error('firstRound must be a positive number');\n    if (!Number.isSafeInteger(txn.lastRound) || txn.lastRound < 0) throw Error('lastRound must be a positive number');\n    if (txn.extraPages !== undefined && (!Number.isInteger(txn.extraPages) || txn.extraPages < 0 || txn.extraPages > 3)) throw Error('extraPages must be an Integer between and including 0 to 3');\n    if (txn.assetTotal !== undefined && (!(Number.isSafeInteger(txn.assetTotal) || typeof txn.assetTotal === 'bigint' && txn.assetTotal <= BigInt('0xffffffffffffffff')) || txn.assetTotal < 0)) throw Error('Total asset issuance must be a positive number and smaller than 2^64-1. If the number is larger than 2^53-1, use bigint.');\n    if (txn.assetDecimals !== undefined && (!Number.isSafeInteger(txn.assetDecimals) || txn.assetDecimals < 0 || txn.assetDecimals > ALGORAND_MAX_ASSET_DECIMALS)) throw Error(`assetDecimals must be a positive number and smaller than ${ALGORAND_MAX_ASSET_DECIMALS.toString()}`);\n    if (txn.assetIndex !== undefined && (!Number.isSafeInteger(txn.assetIndex) || txn.assetIndex < 0)) throw Error('Asset index must be a positive number and smaller than 2^53-1');\n    if (txn.appIndex !== undefined && (!Number.isSafeInteger(txn.appIndex) || txn.appIndex < 0)) throw Error('Application index must be a positive number and smaller than 2^53-1');\n    if (txn.appLocalInts !== undefined && (!Number.isSafeInteger(txn.appLocalInts) || txn.appLocalInts < 0)) throw Error('Application local ints count must be a positive number and smaller than 2^53-1');\n    if (txn.appLocalByteSlices !== undefined && (!Number.isSafeInteger(txn.appLocalByteSlices) || txn.appLocalByteSlices < 0)) throw Error('Application local byte slices count must be a positive number and smaller than 2^53-1');\n    if (txn.appGlobalInts !== undefined && (!Number.isSafeInteger(txn.appGlobalInts) || txn.appGlobalInts < 0)) throw Error('Application global ints count must be a positive number and smaller than 2^53-1');\n    if (txn.appGlobalByteSlices !== undefined && (!Number.isSafeInteger(txn.appGlobalByteSlices) || txn.appGlobalByteSlices < 0)) throw Error('Application global byte slices count must be a positive number and smaller than 2^53-1');\n    if (txn.appApprovalProgram !== undefined) {\n      if (txn.appApprovalProgram.constructor !== Uint8Array) throw Error('appApprovalProgram must be a Uint8Array.');\n    }\n    if (txn.appClearProgram !== undefined) {\n      if (txn.appClearProgram.constructor !== Uint8Array) throw Error('appClearProgram must be a Uint8Array.');\n    }\n    if (txn.appArgs !== undefined) {\n      if (!Array.isArray(txn.appArgs)) throw Error('appArgs must be an Array of Uint8Array.');\n      txn.appArgs = txn.appArgs.slice();\n      txn.appArgs.forEach(arg => {\n        if (arg.constructor !== Uint8Array) throw Error('each element of AppArgs must be a Uint8Array.');\n      });\n    } else {\n      txn.appArgs = [];\n    }\n    if (txn.appAccounts !== undefined) {\n      if (!Array.isArray(txn.appAccounts)) throw Error('appAccounts must be an Array of addresses.');\n      txn.appAccounts = txn.appAccounts.map(addressAsString => address.decodeAddress(addressAsString));\n    }\n    if (txn.appForeignApps !== undefined) {\n      if (!Array.isArray(txn.appForeignApps)) throw Error('appForeignApps must be an Array of integers.');\n      txn.appForeignApps = txn.appForeignApps.slice();\n      txn.appForeignApps.forEach(foreignAppIndex => {\n        if (!Number.isSafeInteger(foreignAppIndex) || foreignAppIndex < 0) throw Error('each foreign application index must be a positive number and smaller than 2^53-1');\n      });\n    }\n    if (txn.appForeignAssets !== undefined) {\n      if (!Array.isArray(txn.appForeignAssets)) throw Error('appForeignAssets must be an Array of integers.');\n      txn.appForeignAssets = txn.appForeignAssets.slice();\n      txn.appForeignAssets.forEach(foreignAssetIndex => {\n        if (!Number.isSafeInteger(foreignAssetIndex) || foreignAssetIndex < 0) throw Error('each foreign asset index must be a positive number and smaller than 2^53-1');\n      });\n    }\n    if (txn.boxes !== undefined) {\n      if (!Array.isArray(txn.boxes)) throw Error('boxes must be an Array of BoxReference.');\n      txn.boxes = txn.boxes.slice();\n      txn.boxes.forEach(box => {\n        if (!Number.isSafeInteger(box.appIndex) || box.name.constructor !== Uint8Array) throw Error('box app index must be a number and name must be an Uint8Array.');\n      });\n    }\n    if (txn.assetMetadataHash !== undefined && txn.assetMetadataHash.length !== 0) {\n      if (typeof txn.assetMetadataHash === 'string') {\n        txn.assetMetadataHash = new Uint8Array(Buffer.from(txn.assetMetadataHash));\n      }\n      if (txn.assetMetadataHash.constructor !== Uint8Array || txn.assetMetadataHash.byteLength !== ASSET_METADATA_HASH_LENGTH) {\n        throw Error(`assetMetadataHash must be a ${ASSET_METADATA_HASH_LENGTH} byte Uint8Array or string.`);\n      }\n      if (txn.assetMetadataHash.every(value => value === 0)) {\n        // if hash contains all 0s, omit it\n        txn.assetMetadataHash = undefined;\n      }\n    } else {\n      txn.assetMetadataHash = undefined;\n    }\n    if (txn.note !== undefined) {\n      if (txn.note.constructor !== Uint8Array) throw Error('note must be a Uint8Array.');\n    } else {\n      txn.note = new Uint8Array(0);\n    }\n    if (txn.lease !== undefined) {\n      if (txn.lease.constructor !== Uint8Array) throw Error('lease must be a Uint8Array.');\n      if (txn.lease.length !== ALGORAND_TRANSACTION_LEASE_LENGTH) throw Error(`lease must be of length ${ALGORAND_TRANSACTION_LEASE_LENGTH.toString()}.`);\n      if (txn.lease.every(value => value === 0)) {\n        // if lease contains all 0s, omit it\n        txn.lease = new Uint8Array(0);\n      }\n    } else {\n      txn.lease = new Uint8Array(0);\n    }\n    txn.voteKey = getKeyregKey(txn.voteKey, 'voteKey', KEYREG_VOTE_KEY_LENGTH);\n    txn.selectionKey = getKeyregKey(txn.selectionKey, 'selectionKey', KEYREG_SELECTION_KEY_LENGTH);\n    txn.stateProofKey = getKeyregKey(txn.stateProofKey, 'stateProofKey', KEYREG_STATE_PROOF_KEY_LENGTH);\n    // Checking non-participation key registration\n    if (txn.nonParticipation && (txn.voteKey || txn.selectionKey || txn.voteFirst || txn.stateProofKey || txn.voteLast || txn.voteKeyDilution)) {\n      throw new Error('nonParticipation is true but participation params are present.');\n    }\n    // Checking online key registration\n    if (!txn.nonParticipation && (txn.voteKey || txn.selectionKey || txn.stateProofKey || txn.voteFirst || txn.voteLast || txn.voteKeyDilution) && !(txn.voteKey && txn.selectionKey && txn.voteFirst && txn.voteLast && txn.voteKeyDilution)\n    // stateProofKey not included here for backwards compatibility\n    ) {\n      throw new Error('online key registration missing at least one of the following fields: ' + 'voteKey, selectionKey, voteFirst, voteLast, voteKeyDilution');\n    }\n    // The last option is an offline key registration where all the fields\n    // nonParticipation, voteKey, selectionKey, voteFirst, voteLast, voteKeyDilution\n    // are all undefined/false\n    // Remove unwanted properties and store transaction on instance\n    delete txn.suggestedParams;\n    Object.assign(this, utils.removeUndefinedProperties(txn));\n    // Modify Fee\n    if (!txn.flatFee) {\n      this.fee *= this.estimateSize();\n      // If suggested fee too small and will be rejected, set to min tx fee\n      if (this.fee < ALGORAND_MIN_TX_FEE) {\n        this.fee = ALGORAND_MIN_TX_FEE;\n      }\n    }\n    // say we are aware of groups\n    this.group = undefined;\n    // stpf fields\n    if (txn.stateProofType !== undefined && (!Number.isSafeInteger(txn.stateProofType) || txn.stateProofType < 0)) throw Error('State Proof type must be a positive number and smaller than 2^53-1');\n    if (txn.stateProofMessage !== undefined) {\n      if (txn.stateProofMessage.constructor !== Uint8Array) throw Error('stateProofMessage must be a Uint8Array.');\n    } else {\n      txn.stateProofMessage = new Uint8Array(0);\n    }\n    if (txn.stateProof !== undefined) {\n      if (txn.stateProof.constructor !== Uint8Array) throw Error('stateProof must be a Uint8Array.');\n    } else {\n      txn.stateProof = new Uint8Array(0);\n    }\n  }\n  // eslint-disable-next-line camelcase\n  get_obj_for_encoding() {\n    if (this.type === 'pay') {\n      const txn = {\n        amt: this.amount,\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: 'pay',\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group\n      };\n      // parse close address\n      if (this.closeRemainderTo !== undefined && address.encodeAddress(this.closeRemainderTo.publicKey) !== address.ALGORAND_ZERO_ADDRESS_STRING) {\n        txn.close = Buffer.from(this.closeRemainderTo.publicKey);\n      }\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      // allowed zero values\n      if (this.to !== undefined) txn.rcv = Buffer.from(this.to.publicKey);\n      if (!txn.note.length) delete txn.note;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (txn.grp === undefined) delete txn.grp;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.rekey) delete txn.rekey;\n      return txn;\n    }\n    if (this.type === 'keyreg') {\n      const txn = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        votekey: this.voteKey,\n        selkey: this.selectionKey,\n        sprfkey: this.stateProofKey,\n        votefst: this.voteFirst,\n        votelst: this.voteLast,\n        votekd: this.voteKeyDilution\n      };\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (txn.grp === undefined) delete txn.grp;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      if (this.nonParticipation) {\n        txn.nonpart = true;\n      }\n      if (!txn.selkey) delete txn.selkey;\n      if (!txn.votekey) delete txn.votekey;\n      if (!txn.sprfkey) delete txn.sprfkey;\n      if (!txn.votefst) delete txn.votefst;\n      if (!txn.votelst) delete txn.votelst;\n      if (!txn.votekd) delete txn.votekd;\n      return txn;\n    }\n    if (this.type === 'acfg') {\n      // asset creation, or asset reconfigure, or asset destruction\n      const txn = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        caid: this.assetIndex,\n        apar: {\n          t: this.assetTotal,\n          df: this.assetDefaultFrozen,\n          dc: this.assetDecimals\n        }\n      };\n      if (this.assetManager !== undefined) txn.apar.m = Buffer.from(this.assetManager.publicKey);\n      if (this.assetReserve !== undefined) txn.apar.r = Buffer.from(this.assetReserve.publicKey);\n      if (this.assetFreeze !== undefined) txn.apar.f = Buffer.from(this.assetFreeze.publicKey);\n      if (this.assetClawback !== undefined) txn.apar.c = Buffer.from(this.assetClawback.publicKey);\n      if (this.assetName !== undefined) txn.apar.an = this.assetName;\n      if (this.assetUnitName !== undefined) txn.apar.un = this.assetUnitName;\n      if (this.assetURL !== undefined) txn.apar.au = this.assetURL;\n      if (this.assetMetadataHash !== undefined) txn.apar.am = Buffer.from(this.assetMetadataHash);\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      if (!txn.caid) delete txn.caid;\n      if (!txn.apar.t && !txn.apar.un && !txn.apar.an && !txn.apar.df && !txn.apar.m && !txn.apar.r && !txn.apar.f && !txn.apar.c && !txn.apar.au && !txn.apar.am && !txn.apar.dc) {\n        delete txn.apar;\n      } else {\n        if (!txn.apar.t) delete txn.apar.t;\n        if (!txn.apar.dc) delete txn.apar.dc;\n        if (!txn.apar.un) delete txn.apar.un;\n        if (!txn.apar.an) delete txn.apar.an;\n        if (!txn.apar.df) delete txn.apar.df;\n        if (!txn.apar.m) delete txn.apar.m;\n        if (!txn.apar.r) delete txn.apar.r;\n        if (!txn.apar.f) delete txn.apar.f;\n        if (!txn.apar.c) delete txn.apar.c;\n        if (!txn.apar.au) delete txn.apar.au;\n        if (!txn.apar.am) delete txn.apar.am;\n      }\n      if (txn.grp === undefined) delete txn.grp;\n      return txn;\n    }\n    if (this.type === 'axfer') {\n      // asset transfer, acceptance, revocation, mint, or burn\n      const txn = {\n        aamt: this.amount,\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        arcv: Buffer.from(this.to.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        xaid: this.assetIndex\n      };\n      if (this.closeRemainderTo !== undefined) txn.aclose = Buffer.from(this.closeRemainderTo.publicKey);\n      if (this.assetRevocationTarget !== undefined) txn.asnd = Buffer.from(this.assetRevocationTarget.publicKey);\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.aamt) delete txn.aamt;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (txn.grp === undefined) delete txn.grp;\n      if (!txn.aclose) delete txn.aclose;\n      if (!txn.asnd) delete txn.asnd;\n      if (!txn.rekey) delete txn.rekey;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      return txn;\n    }\n    if (this.type === 'afrz') {\n      // asset freeze or unfreeze\n      const txn = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        faid: this.assetIndex,\n        afrz: this.freezeState\n      };\n      if (this.freezeAccount !== undefined) txn.fadd = Buffer.from(this.freezeAccount.publicKey);\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (!txn.afrz) delete txn.afrz;\n      if (txn.grp === undefined) delete txn.grp;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      return txn;\n    }\n    if (this.type === 'appl') {\n      // application call of some kind\n      const txn = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        apid: this.appIndex,\n        apan: this.appOnComplete,\n        apls: {\n          nui: this.appLocalInts,\n          nbs: this.appLocalByteSlices\n        },\n        apgs: {\n          nui: this.appGlobalInts,\n          nbs: this.appGlobalByteSlices\n        },\n        apfa: this.appForeignApps,\n        apas: this.appForeignAssets,\n        apep: this.extraPages,\n        apbx: translateBoxReferences(this.boxes, this.appForeignApps, this.appIndex)\n      };\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      if (this.appApprovalProgram !== undefined) {\n        txn.apap = Buffer.from(this.appApprovalProgram);\n      }\n      if (this.appClearProgram !== undefined) {\n        txn.apsu = Buffer.from(this.appClearProgram);\n      }\n      if (this.appArgs !== undefined) {\n        txn.apaa = this.appArgs.map(arg => Buffer.from(arg));\n      }\n      if (this.appAccounts !== undefined) {\n        txn.apat = this.appAccounts.map(decodedAddress => Buffer.from(decodedAddress.publicKey));\n      }\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (!txn.apid) delete txn.apid;\n      if (!txn.apls.nui) delete txn.apls.nui;\n      if (!txn.apls.nbs) delete txn.apls.nbs;\n      if (!txn.apls.nui && !txn.apls.nbs) delete txn.apls;\n      if (!txn.apgs.nui) delete txn.apgs.nui;\n      if (!txn.apgs.nbs) delete txn.apgs.nbs;\n      if (!txn.apaa || !txn.apaa.length) delete txn.apaa;\n      if (!txn.apgs.nui && !txn.apgs.nbs) delete txn.apgs;\n      if (!txn.apap) delete txn.apap;\n      if (!txn.apsu) delete txn.apsu;\n      if (!txn.apan) delete txn.apan;\n      if (!txn.apfa || !txn.apfa.length) delete txn.apfa;\n      if (!txn.apas || !txn.apas.length) delete txn.apas;\n      for (const box of txn.apbx) {\n        if (!box.i) delete box.i;\n        if (!box.n || !box.n.length) delete box.n;\n      }\n      if (!txn.apbx || !txn.apbx.length) delete txn.apbx;\n      if (!txn.apat || !txn.apat.length) delete txn.apat;\n      if (!txn.apep) delete txn.apep;\n      if (txn.grp === undefined) delete txn.grp;\n      return txn;\n    }\n    if (this.type === 'stpf') {\n      // state proof txn\n      const txn = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        sptype: this.stateProofType,\n        spmsg: Buffer.from(this.stateProofMessage),\n        sp: Buffer.from(this.stateProof)\n      };\n      // allowed zero values\n      if (!txn.sptype) delete txn.sptype;\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (!txn.apid) delete txn.apid;\n      if (!txn.apaa || !txn.apaa.length) delete txn.apaa;\n      if (!txn.apap) delete txn.apap;\n      if (!txn.apsu) delete txn.apsu;\n      if (!txn.apan) delete txn.apan;\n      if (!txn.apfa || !txn.apfa.length) delete txn.apfa;\n      if (!txn.apas || !txn.apas.length) delete txn.apas;\n      if (!txn.apat || !txn.apat.length) delete txn.apat;\n      if (!txn.apep) delete txn.apep;\n      if (txn.grp === undefined) delete txn.grp;\n      return txn;\n    }\n    return undefined;\n  }\n  // eslint-disable-next-line camelcase\n  static from_obj_for_encoding(txnForEnc) {\n    const txn = Object.create(this.prototype);\n    txn.name = 'Transaction';\n    txn.tag = Buffer.from('TX');\n    txn.genesisID = txnForEnc.gen;\n    txn.genesisHash = Buffer.from(txnForEnc.gh);\n    if (!isTransactionType(txnForEnc.type)) {\n      throw new Error(`Unrecognized transaction type: ${txnForEnc.type}`);\n    }\n    txn.type = txnForEnc.type;\n    txn.fee = txnForEnc.fee;\n    txn.firstRound = txnForEnc.fv;\n    txn.lastRound = txnForEnc.lv;\n    txn.note = new Uint8Array(txnForEnc.note);\n    txn.lease = new Uint8Array(txnForEnc.lx);\n    txn.from = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.snd)));\n    if (txnForEnc.grp !== undefined) txn.group = Buffer.from(txnForEnc.grp);\n    if (txnForEnc.rekey !== undefined) txn.reKeyTo = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.rekey)));\n    if (txnForEnc.type === 'pay') {\n      txn.amount = txnForEnc.amt;\n      txn.to = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.rcv)));\n      if (txnForEnc.close !== undefined) txn.closeRemainderTo = address.decodeAddress(address.encodeAddress(txnForEnc.close));\n    } else if (txnForEnc.type === 'keyreg') {\n      if (txnForEnc.votekey !== undefined) {\n        txn.voteKey = Buffer.from(txnForEnc.votekey);\n      }\n      if (txnForEnc.selkey !== undefined) {\n        txn.selectionKey = Buffer.from(txnForEnc.selkey);\n      }\n      if (txnForEnc.sprfkey !== undefined) {\n        txn.stateProofKey = Buffer.from(txnForEnc.sprfkey);\n      }\n      if (txnForEnc.votekd !== undefined) {\n        txn.voteKeyDilution = txnForEnc.votekd;\n      }\n      if (txnForEnc.votefst !== undefined) {\n        txn.voteFirst = txnForEnc.votefst;\n      }\n      if (txnForEnc.votelst !== undefined) {\n        txn.voteLast = txnForEnc.votelst;\n      }\n      if (txnForEnc.nonpart !== undefined) {\n        txn.nonParticipation = txnForEnc.nonpart;\n      }\n    } else if (txnForEnc.type === 'acfg') {\n      // asset creation, or asset reconfigure, or asset destruction\n      if (txnForEnc.caid !== undefined) {\n        txn.assetIndex = txnForEnc.caid;\n      }\n      if (txnForEnc.apar !== undefined) {\n        txn.assetTotal = txnForEnc.apar.t;\n        txn.assetDefaultFrozen = txnForEnc.apar.df;\n        if (txnForEnc.apar.dc !== undefined) txn.assetDecimals = txnForEnc.apar.dc;\n        if (txnForEnc.apar.m !== undefined) txn.assetManager = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.apar.m)));\n        if (txnForEnc.apar.r !== undefined) txn.assetReserve = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.apar.r)));\n        if (txnForEnc.apar.f !== undefined) txn.assetFreeze = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.apar.f)));\n        if (txnForEnc.apar.c !== undefined) txn.assetClawback = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.apar.c)));\n        if (txnForEnc.apar.un !== undefined) txn.assetUnitName = txnForEnc.apar.un;\n        if (txnForEnc.apar.an !== undefined) txn.assetName = txnForEnc.apar.an;\n        if (txnForEnc.apar.au !== undefined) txn.assetURL = txnForEnc.apar.au;\n        if (txnForEnc.apar.am !== undefined) txn.assetMetadataHash = txnForEnc.apar.am;\n      }\n    } else if (txnForEnc.type === 'axfer') {\n      // asset transfer, acceptance, revocation, mint, or burn\n      if (txnForEnc.xaid !== undefined) {\n        txn.assetIndex = txnForEnc.xaid;\n      }\n      if (txnForEnc.aamt !== undefined) txn.amount = txnForEnc.aamt;\n      if (txnForEnc.aclose !== undefined) {\n        txn.closeRemainderTo = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.aclose)));\n      }\n      if (txnForEnc.asnd !== undefined) {\n        txn.assetRevocationTarget = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.asnd)));\n      }\n      txn.to = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.arcv)));\n    } else if (txnForEnc.type === 'afrz') {\n      if (txnForEnc.afrz !== undefined) {\n        txn.freezeState = txnForEnc.afrz;\n      }\n      if (txnForEnc.faid !== undefined) {\n        txn.assetIndex = txnForEnc.faid;\n      }\n      txn.freezeAccount = address.decodeAddress(address.encodeAddress(new Uint8Array(txnForEnc.fadd)));\n    } else if (txnForEnc.type === 'appl') {\n      if (txnForEnc.apid !== undefined) {\n        txn.appIndex = txnForEnc.apid;\n      }\n      if (txnForEnc.apan !== undefined) {\n        txn.appOnComplete = txnForEnc.apan;\n      }\n      if (txnForEnc.apls !== undefined) {\n        if (txnForEnc.apls.nui !== undefined) txn.appLocalInts = txnForEnc.apls.nui;\n        if (txnForEnc.apls.nbs !== undefined) txn.appLocalByteSlices = txnForEnc.apls.nbs;\n      }\n      if (txnForEnc.apgs !== undefined) {\n        if (txnForEnc.apgs.nui !== undefined) txn.appGlobalInts = txnForEnc.apgs.nui;\n        if (txnForEnc.apgs.nbs !== undefined) txn.appGlobalByteSlices = txnForEnc.apgs.nbs;\n      }\n      if (txnForEnc.apep !== undefined) {\n        txn.extraPages = txnForEnc.apep;\n      }\n      if (txnForEnc.apap !== undefined) {\n        txn.appApprovalProgram = new Uint8Array(txnForEnc.apap);\n      }\n      if (txnForEnc.apsu !== undefined) {\n        txn.appClearProgram = new Uint8Array(txnForEnc.apsu);\n      }\n      if (txnForEnc.apaa !== undefined) {\n        txn.appArgs = txnForEnc.apaa.map(arg => new Uint8Array(arg));\n      }\n      if (txnForEnc.apat !== undefined) {\n        txn.appAccounts = txnForEnc.apat.map(addressBytes => address.decodeAddress(address.encodeAddress(new Uint8Array(addressBytes))));\n      }\n      if (txnForEnc.apfa !== undefined) {\n        txn.appForeignApps = txnForEnc.apfa;\n      }\n      if (txnForEnc.apas !== undefined) {\n        txn.appForeignAssets = txnForEnc.apas;\n      }\n      if (txnForEnc.apbx !== undefined) {\n        txn.boxes = txnForEnc.apbx.map(box => ({\n          // We return 0 for the app ID so that it's guaranteed translateBoxReferences will\n          // translate the app index back to 0. If we instead returned the called app ID,\n          // translateBoxReferences would translate the app index to a nonzero value if the called\n          // app is also in the foreign app array.\n          appIndex: box.i ? txn.appForeignApps[box.i - 1] : 0,\n          name: box.n\n        }));\n      }\n    } else if (txnForEnc.type === 'stpf') {\n      if (txnForEnc.sptype !== undefined) {\n        txn.stateProofType = txnForEnc.sptype;\n      }\n      if (txnForEnc.sp !== undefined) {\n        txn.stateProof = txnForEnc.sp;\n      }\n      if (txnForEnc.spmsg !== undefined) {\n        txn.stateProofMessage = txnForEnc.spmsg;\n      }\n    }\n    return txn;\n  }\n  estimateSize() {\n    return this.toByte().length + NUM_ADDL_BYTES_AFTER_SIGNING;\n  }\n  bytesToSign() {\n    const encodedMsg = this.toByte();\n    return Buffer.from(utils.concatArrays(this.tag, encodedMsg));\n  }\n  toByte() {\n    return encoding.encode(this.get_obj_for_encoding());\n  }\n  // returns the raw signature\n  rawSignTxn(sk) {\n    const toBeSigned = this.bytesToSign();\n    const sig = nacl.sign(toBeSigned, sk);\n    return Buffer.from(sig);\n  }\n  signTxn(sk) {\n    // construct signed message\n    const sTxn = {\n      sig: this.rawSignTxn(sk),\n      txn: this.get_obj_for_encoding()\n    };\n    // add AuthAddr if signing with a different key than From indicates\n    const keypair = nacl.keyPairFromSecretKey(sk);\n    const pubKeyFromSk = keypair.publicKey;\n    if (address.encodeAddress(pubKeyFromSk) !== address.encodeAddress(this.from.publicKey)) {\n      sTxn.sgnr = Buffer.from(pubKeyFromSk);\n    }\n    return new Uint8Array(encoding.encode(sTxn));\n  }\n  attachSignature(signerAddr, signature) {\n    if (!nacl.isValidSignatureLength(signature.length)) {\n      throw new Error('Invalid signature length');\n    }\n    const sTxn = {\n      sig: Buffer.from(signature),\n      txn: this.get_obj_for_encoding()\n    };\n    // add AuthAddr if signing with a different key than From indicates\n    if (signerAddr !== address.encodeAddress(this.from.publicKey)) {\n      const signerPublicKey = address.decodeAddress(signerAddr).publicKey;\n      sTxn.sgnr = Buffer.from(signerPublicKey);\n    }\n    return new Uint8Array(encoding.encode(sTxn));\n  }\n  rawTxID() {\n    const enMsg = this.toByte();\n    const gh = Buffer.from(utils.concatArrays(this.tag, enMsg));\n    return Buffer.from(nacl.genericHash(gh));\n  }\n  txID() {\n    const hash = this.rawTxID();\n    return base32.encode(hash).slice(0, ALGORAND_TRANSACTION_LENGTH);\n  }\n  // add a lease to a transaction not yet having\n  // supply feePerByte to increment fee accordingly\n  addLease(lease) {\n    let feePerByte = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    let mutableLease;\n    if (lease !== undefined) {\n      if (lease.constructor !== Uint8Array) throw Error('lease must be a Uint8Array.');\n      if (lease.length !== ALGORAND_TRANSACTION_LEASE_LENGTH) throw Error(`lease must be of length ${ALGORAND_TRANSACTION_LEASE_LENGTH.toString()}.`);\n      mutableLease = new Uint8Array(lease);\n    } else {\n      mutableLease = new Uint8Array(0);\n    }\n    this.lease = mutableLease;\n    if (feePerByte !== 0) {\n      this.fee += (ALGORAND_TRANSACTION_LEASE_LABEL_LENGTH + ALGORAND_TRANSACTION_LEASE_LENGTH) * feePerByte;\n    }\n  }\n  // add the rekey-to field to a transaction not yet having it\n  // supply feePerByte to increment fee accordingly\n  addRekey(reKeyTo) {\n    let feePerByte = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    if (reKeyTo !== undefined) {\n      this.reKeyTo = address.decodeAddress(reKeyTo);\n    }\n    if (feePerByte !== 0) {\n      this.fee += (ALGORAND_TRANSACTION_REKEY_LABEL_LENGTH + ALGORAND_TRANSACTION_ADDRESS_LENGTH) * feePerByte;\n    }\n  }\n  // build display dict for prettyPrint and toString\n  // eslint-disable-next-line no-underscore-dangle\n  _getDictForDisplay() {\n    const forPrinting = {\n      ...this\n    };\n    forPrinting.tag = forPrinting.tag.toString();\n    forPrinting.from = address.encodeAddress(forPrinting.from.publicKey);\n    if (forPrinting.to !== undefined) forPrinting.to = address.encodeAddress(forPrinting.to.publicKey);\n    // things that need fixing:\n    if (forPrinting.freezeAccount !== undefined) forPrinting.freezeAccount = address.encodeAddress(forPrinting.freezeAccount.publicKey);\n    if (forPrinting.closeRemainderTo !== undefined) forPrinting.closeRemainderTo = address.encodeAddress(forPrinting.closeRemainderTo.publicKey);\n    if (forPrinting.assetManager !== undefined) forPrinting.assetManager = address.encodeAddress(forPrinting.assetManager.publicKey);\n    if (forPrinting.assetReserve !== undefined) forPrinting.assetReserve = address.encodeAddress(forPrinting.assetReserve.publicKey);\n    if (forPrinting.assetFreeze !== undefined) forPrinting.assetFreeze = address.encodeAddress(forPrinting.assetFreeze.publicKey);\n    if (forPrinting.assetClawback !== undefined) forPrinting.assetClawback = address.encodeAddress(forPrinting.assetClawback.publicKey);\n    if (forPrinting.assetRevocationTarget !== undefined) forPrinting.assetRevocationTarget = address.encodeAddress(forPrinting.assetRevocationTarget.publicKey);\n    if (forPrinting.reKeyTo !== undefined) forPrinting.reKeyTo = address.encodeAddress(forPrinting.reKeyTo.publicKey);\n    forPrinting.genesisHash = forPrinting.genesisHash.toString('base64');\n    return forPrinting;\n  }\n  // pretty print the transaction to console\n  prettyPrint() {\n    // eslint-disable-next-line no-underscore-dangle,no-console\n    console.log(this._getDictForDisplay());\n  }\n  // get string representation\n  toString() {\n    // eslint-disable-next-line no-underscore-dangle\n    return JSON.stringify(this._getDictForDisplay());\n  }\n}\n/**\n * encodeUnsignedSimulateTransaction takes a txnBuilder.Transaction object,\n * converts it into a SignedTransaction-like object, and converts it to a Buffer.\n *\n * Note: this function should only be used to simulate unsigned transactions.\n *\n * @param transactionObject - Transaction object to simulate.\n */\nexport function encodeUnsignedSimulateTransaction(transactionObject) {\n  const objToEncode = {\n    sig: null,\n    txn: transactionObject.get_obj_for_encoding()\n  };\n  return encoding.rawEncode(objToEncode);\n}\n/**\n * encodeUnsignedTransaction takes a completed txnBuilder.Transaction object, such as from the makeFoo\n * family of transactions, and converts it to a Buffer\n * @param transactionObject - the completed Transaction object\n */\nexport function encodeUnsignedTransaction(transactionObject) {\n  const objToEncode = transactionObject.get_obj_for_encoding();\n  return encoding.encode(objToEncode);\n}\n/**\n * decodeUnsignedTransaction takes a Buffer (as if from encodeUnsignedTransaction) and converts it to a txnBuilder.Transaction object\n * @param transactionBuffer - the Uint8Array containing a transaction\n */\nexport function decodeUnsignedTransaction(transactionBuffer) {\n  const partlyDecodedObject = encoding.decode(transactionBuffer);\n  return Transaction.from_obj_for_encoding(partlyDecodedObject);\n}\n/**\n * decodeSignedTransaction takes a Buffer (from transaction.signTxn) and converts it to an object\n * containing the Transaction (txn), the signature (sig), and the auth-addr field if applicable (sgnr)\n * @param transactionBuffer - the Uint8Array containing a transaction\n * @returns containing a Transaction, the signature, and possibly an auth-addr field\n */\nexport function decodeSignedTransaction(transactionBuffer) {\n  const stxnDecoded = encoding.decode(transactionBuffer);\n  const stxn = {\n    ...stxnDecoded,\n    txn: Transaction.from_obj_for_encoding(stxnDecoded.txn)\n  };\n  return stxn;\n}\nexport function instantiateTxnIfNeeded(transactionLike) {\n  return transactionLike instanceof Transaction ? transactionLike : new Transaction(transactionLike);\n}\nexport default Transaction;","map":{"version":3,"names":["Buffer","base32","address","encoding","nacl","utils","translateBoxReferences","TransactionType","isTransactionType","ALGORAND_TRANSACTION_LENGTH","ALGORAND_MIN_TX_FEE","ALGORAND_TRANSACTION_LEASE_LENGTH","ALGORAND_MAX_ASSET_DECIMALS","NUM_ADDL_BYTES_AFTER_SIGNING","ALGORAND_TRANSACTION_LEASE_LABEL_LENGTH","ALGORAND_TRANSACTION_ADDRESS_LENGTH","ALGORAND_TRANSACTION_REKEY_LABEL_LENGTH","ASSET_METADATA_HASH_LENGTH","KEYREG_VOTE_KEY_LENGTH","KEYREG_SELECTION_KEY_LENGTH","KEYREG_STATE_PROOF_KEY_LENGTH","getKeyregKey","input","inputName","length","undefined","inputAsBuffer","from","constructor","Uint8Array","isBuffer","byteLength","Error","Transaction","_ref","transaction","name","tag","defaults","type","pay","flatFee","nonParticipation","keyreg","voteKey","suggestedParams","reference","genesisHash","fee","firstRound","lastRound","genesisID","txn","decodeAddress","to","closeRemainderTo","assetManager","assetReserve","assetFreeze","assetClawback","assetRevocationTarget","freezeAccount","reKeyTo","amount","Number","isSafeInteger","BigInt","extraPages","isInteger","assetTotal","assetDecimals","toString","assetIndex","appIndex","appLocalInts","appLocalByteSlices","appGlobalInts","appGlobalByteSlices","appApprovalProgram","appClearProgram","appArgs","Array","isArray","slice","forEach","arg","appAccounts","map","addressAsString","appForeignApps","foreignAppIndex","appForeignAssets","foreignAssetIndex","boxes","box","assetMetadataHash","every","value","note","lease","selectionKey","stateProofKey","voteFirst","voteLast","voteKeyDilution","Object","assign","removeUndefinedProperties","estimateSize","group","stateProofType","stateProofMessage","stateProof","get_obj_for_encoding","amt","fv","lv","snd","publicKey","gen","gh","lx","grp","encodeAddress","ALGORAND_ZERO_ADDRESS_STRING","close","rekey","rcv","votekey","selkey","sprfkey","votefst","votelst","votekd","nonpart","caid","apar","t","df","assetDefaultFrozen","dc","m","r","f","c","assetName","an","assetUnitName","un","assetURL","au","am","aamt","arcv","xaid","aclose","asnd","faid","afrz","freezeState","fadd","apid","apan","appOnComplete","apls","nui","nbs","apgs","apfa","apas","apep","apbx","apap","apsu","apaa","apat","decodedAddress","i","n","sptype","spmsg","sp","from_obj_for_encoding","txnForEnc","create","prototype","addressBytes","toByte","bytesToSign","encodedMsg","concatArrays","encode","rawSignTxn","sk","toBeSigned","sig","sign","signTxn","sTxn","keypair","keyPairFromSecretKey","pubKeyFromSk","sgnr","attachSignature","signerAddr","signature","isValidSignatureLength","signerPublicKey","rawTxID","enMsg","genericHash","txID","hash","addLease","feePerByte","arguments","mutableLease","addRekey","_getDictForDisplay","forPrinting","prettyPrint","console","log","JSON","stringify","encodeUnsignedSimulateTransaction","transactionObject","objToEncode","rawEncode","encodeUnsignedTransaction","decodeUnsignedTransaction","transactionBuffer","partlyDecodedObject","decode","decodeSignedTransaction","stxnDecoded","stxn","instantiateTxnIfNeeded","transactionLike"],"sources":["/home/danica/morra/frontend/node_modules/algosdk/src/transaction.ts"],"sourcesContent":["import { Buffer } from 'buffer';\nimport base32 from 'hi-base32';\nimport * as address from './encoding/address';\nimport * as encoding from './encoding/encoding';\nimport * as nacl from './nacl/naclWrappers';\nimport * as utils from './utils/utils';\nimport { translateBoxReferences } from './boxStorage';\nimport {\n  OnApplicationComplete,\n  TransactionParams,\n  TransactionType,\n  isTransactionType,\n  BoxReference,\n} from './types/transactions/base';\nimport AnyTransaction, {\n  MustHaveSuggestedParams,\n  MustHaveSuggestedParamsInline,\n  EncodedTransaction,\n  EncodedSignedTransaction,\n  EncodedMultisig,\n  EncodedLogicSig,\n} from './types/transactions';\nimport { Address } from './types/address';\n\nconst ALGORAND_TRANSACTION_LENGTH = 52;\nexport const ALGORAND_MIN_TX_FEE = 1000; // version v5\nconst ALGORAND_TRANSACTION_LEASE_LENGTH = 32;\nconst ALGORAND_MAX_ASSET_DECIMALS = 19;\nconst NUM_ADDL_BYTES_AFTER_SIGNING = 75; // NUM_ADDL_BYTES_AFTER_SIGNING is the number of bytes added to a txn after signing it\nconst ALGORAND_TRANSACTION_LEASE_LABEL_LENGTH = 5;\nconst ALGORAND_TRANSACTION_ADDRESS_LENGTH = 32;\nconst ALGORAND_TRANSACTION_REKEY_LABEL_LENGTH = 5;\nconst ASSET_METADATA_HASH_LENGTH = 32;\nconst KEYREG_VOTE_KEY_LENGTH = 32;\nconst KEYREG_SELECTION_KEY_LENGTH = 32;\nconst KEYREG_STATE_PROOF_KEY_LENGTH = 64;\n\ntype AnyTransactionWithParams = MustHaveSuggestedParams<AnyTransaction>;\ntype AnyTransactionWithParamsInline = MustHaveSuggestedParamsInline<AnyTransaction>;\n\n/**\n * A modified version of the transaction params. Represents the internal structure that the Transaction class uses\n * to store inputted transaction objects.\n */\n// Omit allows overwriting properties\ninterface TransactionStorageStructure\n  extends Omit<\n    TransactionParams,\n    | 'from'\n    | 'to'\n    | 'genesisHash'\n    | 'closeRemainderTo'\n    | 'voteKey'\n    | 'selectionKey'\n    | 'stateProofKey'\n    | 'assetManager'\n    | 'assetReserve'\n    | 'assetFreeze'\n    | 'assetClawback'\n    | 'assetRevocationTarget'\n    | 'freezeAccount'\n    | 'appAccounts'\n    | 'suggestedParams'\n    | 'reKeyTo'\n  > {\n  from: string | Address;\n  to: string | Address;\n  fee: number;\n  amount: number | bigint;\n  firstRound: number;\n  lastRound: number;\n  note?: Uint8Array;\n  genesisID: string;\n  genesisHash: string | Buffer;\n  lease?: Uint8Array;\n  closeRemainderTo?: string | Address;\n  voteKey: string | Buffer;\n  selectionKey: string | Buffer;\n  stateProofKey: string | Buffer;\n  voteFirst: number;\n  voteLast: number;\n  voteKeyDilution: number;\n  assetIndex: number;\n  assetTotal: number | bigint;\n  assetDecimals: number;\n  assetDefaultFrozen: boolean;\n  assetManager: string | Address;\n  assetReserve: string | Address;\n  assetFreeze: string | Address;\n  assetClawback: string | Address;\n  assetUnitName: string;\n  assetName: string;\n  assetURL: string;\n  assetMetadataHash?: string | Uint8Array;\n  freezeAccount: string | Address;\n  freezeState: boolean;\n  assetRevocationTarget?: string | Address;\n  appIndex: number;\n  appOnComplete: OnApplicationComplete;\n  appLocalInts: number;\n  appLocalByteSlices: number;\n  appGlobalInts: number;\n  appGlobalByteSlices: number;\n  appApprovalProgram: Uint8Array;\n  appClearProgram: Uint8Array;\n  appArgs?: Uint8Array[];\n  appAccounts?: string[] | Address[];\n  appForeignApps?: number[];\n  appForeignAssets?: number[];\n  type?: TransactionType;\n  flatFee: boolean;\n  reKeyTo?: string | Address;\n  nonParticipation?: boolean;\n  group?: Buffer;\n  extraPages?: number;\n  boxes?: BoxReference[];\n  stateProofType?: number | bigint;\n  stateProof?: Uint8Array;\n  stateProofMessage?: Uint8Array;\n}\n\nfunction getKeyregKey(\n  input: undefined | string | Uint8Array | Buffer,\n  inputName: string,\n  length: number\n): Buffer | undefined {\n  if (input == null) {\n    return undefined;\n  }\n\n  let inputAsBuffer: Buffer | undefined;\n\n  if (typeof input === 'string') {\n    inputAsBuffer = Buffer.from(input, 'base64');\n  } else if (input.constructor === Uint8Array) {\n    inputAsBuffer = Buffer.from(input);\n  } else if (Buffer.isBuffer(input)) {\n    inputAsBuffer = input;\n  }\n\n  if (inputAsBuffer == null || inputAsBuffer.byteLength !== length) {\n    throw Error(\n      `${inputName} must be a ${length} byte Uint8Array or Buffer or base64 string.`\n    );\n  }\n\n  return inputAsBuffer;\n}\n\n/**\n * Transaction enables construction of Algorand transactions\n * */\nexport class Transaction implements TransactionStorageStructure {\n  name = 'Transaction';\n  tag = Buffer.from('TX');\n\n  // Implement transaction params\n  from: Address;\n  to: Address;\n  fee: number;\n  amount: number | bigint;\n  firstRound: number;\n  lastRound: number;\n  note?: Uint8Array;\n  genesisID: string;\n  genesisHash: Buffer;\n  lease?: Uint8Array;\n  closeRemainderTo?: Address;\n  voteKey: Buffer;\n  selectionKey: Buffer;\n  stateProofKey: Buffer;\n  voteFirst: number;\n  voteLast: number;\n  voteKeyDilution: number;\n  assetIndex: number;\n  assetTotal: number | bigint;\n  assetDecimals: number;\n  assetDefaultFrozen: boolean;\n  assetManager: Address;\n  assetReserve: Address;\n  assetFreeze: Address;\n  assetClawback: Address;\n  assetUnitName: string;\n  assetName: string;\n  assetURL: string;\n  assetMetadataHash?: Uint8Array;\n  freezeAccount: Address;\n  freezeState: boolean;\n  assetRevocationTarget?: Address;\n  appIndex: number;\n  appOnComplete: OnApplicationComplete;\n  appLocalInts: number;\n  appLocalByteSlices: number;\n  appGlobalInts: number;\n  appGlobalByteSlices: number;\n  appApprovalProgram: Uint8Array;\n  appClearProgram: Uint8Array;\n  appArgs?: Uint8Array[];\n  appAccounts?: Address[];\n  appForeignApps?: number[];\n  appForeignAssets?: number[];\n  boxes?: BoxReference[];\n  type?: TransactionType;\n  flatFee: boolean;\n  reKeyTo?: Address;\n  nonParticipation?: boolean;\n  group?: Buffer;\n  extraPages?: number;\n  stateProofType?: number | bigint;\n  stateProof?: Uint8Array;\n  stateProofMessage?: Uint8Array;\n\n  constructor({ ...transaction }: AnyTransaction) {\n    // Populate defaults\n    /* eslint-disable no-param-reassign */\n    const defaults: Partial<TransactionParams> = {\n      type: TransactionType.pay,\n      flatFee: false,\n      nonParticipation: false,\n    };\n    // Default type\n    if (typeof transaction.type === 'undefined') {\n      transaction.type = defaults.type;\n    }\n    // Default flatFee\n    if (\n      typeof (transaction as AnyTransactionWithParamsInline).flatFee ===\n      'undefined'\n    ) {\n      (transaction as AnyTransactionWithParamsInline).flatFee =\n        defaults.flatFee;\n    }\n    // Default nonParticipation\n    if (\n      transaction.type === TransactionType.keyreg &&\n      typeof transaction.voteKey !== 'undefined' &&\n      typeof transaction.nonParticipation === 'undefined'\n    ) {\n      transaction.nonParticipation = defaults.nonParticipation;\n    }\n    /* eslint-enable no-param-reassign */\n\n    // Move suggested parameters from its object to inline\n    if (\n      (transaction as AnyTransactionWithParams).suggestedParams !== undefined\n    ) {\n      // Create a temporary reference to the transaction object that has params inline and also as a suggested params object\n      //   - Helpful for moving params from named object to inline\n      const reference = transaction as AnyTransactionWithParams &\n        AnyTransactionWithParamsInline;\n      reference.genesisHash = reference.suggestedParams.genesisHash;\n      reference.fee = reference.suggestedParams.fee;\n      if (reference.suggestedParams.flatFee !== undefined)\n        reference.flatFee = reference.suggestedParams.flatFee;\n      reference.firstRound = reference.suggestedParams.firstRound;\n      reference.lastRound = reference.suggestedParams.lastRound;\n      reference.genesisID = reference.suggestedParams.genesisID;\n    }\n\n    // At this point all suggestedParams have been moved to be inline, so we can reassign the transaction object type\n    // to one which is more useful as we prepare properties for storing\n    const txn = transaction as TransactionStorageStructure;\n\n    txn.from = address.decodeAddress(txn.from as string);\n    if (txn.to !== undefined) txn.to = address.decodeAddress(txn.to as string);\n    if (txn.closeRemainderTo !== undefined)\n      txn.closeRemainderTo = address.decodeAddress(\n        txn.closeRemainderTo as string\n      );\n    if (txn.assetManager !== undefined)\n      txn.assetManager = address.decodeAddress(txn.assetManager as string);\n    if (txn.assetReserve !== undefined)\n      txn.assetReserve = address.decodeAddress(txn.assetReserve as string);\n    if (txn.assetFreeze !== undefined)\n      txn.assetFreeze = address.decodeAddress(txn.assetFreeze as string);\n    if (txn.assetClawback !== undefined)\n      txn.assetClawback = address.decodeAddress(txn.assetClawback as string);\n    if (txn.assetRevocationTarget !== undefined)\n      txn.assetRevocationTarget = address.decodeAddress(\n        txn.assetRevocationTarget as string\n      );\n    if (txn.freezeAccount !== undefined)\n      txn.freezeAccount = address.decodeAddress(txn.freezeAccount as string);\n    if (txn.reKeyTo !== undefined)\n      txn.reKeyTo = address.decodeAddress(txn.reKeyTo as string);\n    if (txn.genesisHash === undefined)\n      throw Error('genesis hash must be specified and in a base64 string.');\n\n    txn.genesisHash = Buffer.from(txn.genesisHash as string, 'base64');\n\n    if (\n      txn.amount !== undefined &&\n      (!(\n        Number.isSafeInteger(txn.amount) ||\n        (typeof txn.amount === 'bigint' &&\n          txn.amount <= BigInt('0xffffffffffffffff'))\n      ) ||\n        txn.amount < 0)\n    )\n      throw Error(\n        'Amount must be a positive number and smaller than 2^64-1. If the number is larger than 2^53-1, use bigint.'\n      );\n    if (!Number.isSafeInteger(txn.fee) || txn.fee < 0)\n      throw Error('fee must be a positive number and smaller than 2^53-1');\n    if (!Number.isSafeInteger(txn.firstRound) || txn.firstRound < 0)\n      throw Error('firstRound must be a positive number');\n    if (!Number.isSafeInteger(txn.lastRound) || txn.lastRound < 0)\n      throw Error('lastRound must be a positive number');\n    if (\n      txn.extraPages !== undefined &&\n      (!Number.isInteger(txn.extraPages) ||\n        txn.extraPages < 0 ||\n        txn.extraPages > 3)\n    )\n      throw Error('extraPages must be an Integer between and including 0 to 3');\n    if (\n      txn.assetTotal !== undefined &&\n      (!(\n        Number.isSafeInteger(txn.assetTotal) ||\n        (typeof txn.assetTotal === 'bigint' &&\n          txn.assetTotal <= BigInt('0xffffffffffffffff'))\n      ) ||\n        txn.assetTotal < 0)\n    )\n      throw Error(\n        'Total asset issuance must be a positive number and smaller than 2^64-1. If the number is larger than 2^53-1, use bigint.'\n      );\n    if (\n      txn.assetDecimals !== undefined &&\n      (!Number.isSafeInteger(txn.assetDecimals) ||\n        txn.assetDecimals < 0 ||\n        txn.assetDecimals > ALGORAND_MAX_ASSET_DECIMALS)\n    )\n      throw Error(\n        `assetDecimals must be a positive number and smaller than ${ALGORAND_MAX_ASSET_DECIMALS.toString()}`\n      );\n    if (\n      txn.assetIndex !== undefined &&\n      (!Number.isSafeInteger(txn.assetIndex) || txn.assetIndex < 0)\n    )\n      throw Error(\n        'Asset index must be a positive number and smaller than 2^53-1'\n      );\n    if (\n      txn.appIndex !== undefined &&\n      (!Number.isSafeInteger(txn.appIndex) || txn.appIndex < 0)\n    )\n      throw Error(\n        'Application index must be a positive number and smaller than 2^53-1'\n      );\n    if (\n      txn.appLocalInts !== undefined &&\n      (!Number.isSafeInteger(txn.appLocalInts) || txn.appLocalInts < 0)\n    )\n      throw Error(\n        'Application local ints count must be a positive number and smaller than 2^53-1'\n      );\n    if (\n      txn.appLocalByteSlices !== undefined &&\n      (!Number.isSafeInteger(txn.appLocalByteSlices) ||\n        txn.appLocalByteSlices < 0)\n    )\n      throw Error(\n        'Application local byte slices count must be a positive number and smaller than 2^53-1'\n      );\n    if (\n      txn.appGlobalInts !== undefined &&\n      (!Number.isSafeInteger(txn.appGlobalInts) || txn.appGlobalInts < 0)\n    )\n      throw Error(\n        'Application global ints count must be a positive number and smaller than 2^53-1'\n      );\n    if (\n      txn.appGlobalByteSlices !== undefined &&\n      (!Number.isSafeInteger(txn.appGlobalByteSlices) ||\n        txn.appGlobalByteSlices < 0)\n    )\n      throw Error(\n        'Application global byte slices count must be a positive number and smaller than 2^53-1'\n      );\n    if (txn.appApprovalProgram !== undefined) {\n      if (txn.appApprovalProgram.constructor !== Uint8Array)\n        throw Error('appApprovalProgram must be a Uint8Array.');\n    }\n    if (txn.appClearProgram !== undefined) {\n      if (txn.appClearProgram.constructor !== Uint8Array)\n        throw Error('appClearProgram must be a Uint8Array.');\n    }\n    if (txn.appArgs !== undefined) {\n      if (!Array.isArray(txn.appArgs))\n        throw Error('appArgs must be an Array of Uint8Array.');\n      txn.appArgs = txn.appArgs.slice();\n      txn.appArgs.forEach((arg) => {\n        if (arg.constructor !== Uint8Array)\n          throw Error('each element of AppArgs must be a Uint8Array.');\n      });\n    } else {\n      txn.appArgs = [];\n    }\n    if (txn.appAccounts !== undefined) {\n      if (!Array.isArray(txn.appAccounts))\n        throw Error('appAccounts must be an Array of addresses.');\n      txn.appAccounts = txn.appAccounts.map((addressAsString) =>\n        address.decodeAddress(addressAsString)\n      );\n    }\n    if (txn.appForeignApps !== undefined) {\n      if (!Array.isArray(txn.appForeignApps))\n        throw Error('appForeignApps must be an Array of integers.');\n      txn.appForeignApps = txn.appForeignApps.slice();\n      txn.appForeignApps.forEach((foreignAppIndex) => {\n        if (!Number.isSafeInteger(foreignAppIndex) || foreignAppIndex < 0)\n          throw Error(\n            'each foreign application index must be a positive number and smaller than 2^53-1'\n          );\n      });\n    }\n    if (txn.appForeignAssets !== undefined) {\n      if (!Array.isArray(txn.appForeignAssets))\n        throw Error('appForeignAssets must be an Array of integers.');\n      txn.appForeignAssets = txn.appForeignAssets.slice();\n      txn.appForeignAssets.forEach((foreignAssetIndex) => {\n        if (!Number.isSafeInteger(foreignAssetIndex) || foreignAssetIndex < 0)\n          throw Error(\n            'each foreign asset index must be a positive number and smaller than 2^53-1'\n          );\n      });\n    }\n    if (txn.boxes !== undefined) {\n      if (!Array.isArray(txn.boxes))\n        throw Error('boxes must be an Array of BoxReference.');\n      txn.boxes = txn.boxes.slice();\n      txn.boxes.forEach((box) => {\n        if (\n          !Number.isSafeInteger(box.appIndex) ||\n          box.name.constructor !== Uint8Array\n        )\n          throw Error(\n            'box app index must be a number and name must be an Uint8Array.'\n          );\n      });\n    }\n    if (\n      txn.assetMetadataHash !== undefined &&\n      txn.assetMetadataHash.length !== 0\n    ) {\n      if (typeof txn.assetMetadataHash === 'string') {\n        txn.assetMetadataHash = new Uint8Array(\n          Buffer.from(txn.assetMetadataHash)\n        );\n      }\n\n      if (\n        txn.assetMetadataHash.constructor !== Uint8Array ||\n        txn.assetMetadataHash.byteLength !== ASSET_METADATA_HASH_LENGTH\n      ) {\n        throw Error(\n          `assetMetadataHash must be a ${ASSET_METADATA_HASH_LENGTH} byte Uint8Array or string.`\n        );\n      }\n\n      if (txn.assetMetadataHash.every((value) => value === 0)) {\n        // if hash contains all 0s, omit it\n        txn.assetMetadataHash = undefined;\n      }\n    } else {\n      txn.assetMetadataHash = undefined;\n    }\n    if (txn.note !== undefined) {\n      if (txn.note.constructor !== Uint8Array)\n        throw Error('note must be a Uint8Array.');\n    } else {\n      txn.note = new Uint8Array(0);\n    }\n    if (txn.lease !== undefined) {\n      if (txn.lease.constructor !== Uint8Array)\n        throw Error('lease must be a Uint8Array.');\n      if (txn.lease.length !== ALGORAND_TRANSACTION_LEASE_LENGTH)\n        throw Error(\n          `lease must be of length ${ALGORAND_TRANSACTION_LEASE_LENGTH.toString()}.`\n        );\n      if (txn.lease.every((value) => value === 0)) {\n        // if lease contains all 0s, omit it\n        txn.lease = new Uint8Array(0);\n      }\n    } else {\n      txn.lease = new Uint8Array(0);\n    }\n    txn.voteKey = getKeyregKey(txn.voteKey, 'voteKey', KEYREG_VOTE_KEY_LENGTH);\n    txn.selectionKey = getKeyregKey(\n      txn.selectionKey,\n      'selectionKey',\n      KEYREG_SELECTION_KEY_LENGTH\n    );\n    txn.stateProofKey = getKeyregKey(\n      txn.stateProofKey,\n      'stateProofKey',\n      KEYREG_STATE_PROOF_KEY_LENGTH\n    );\n    // Checking non-participation key registration\n    if (\n      txn.nonParticipation &&\n      (txn.voteKey ||\n        txn.selectionKey ||\n        txn.voteFirst ||\n        txn.stateProofKey ||\n        txn.voteLast ||\n        txn.voteKeyDilution)\n    ) {\n      throw new Error(\n        'nonParticipation is true but participation params are present.'\n      );\n    }\n    // Checking online key registration\n    if (\n      !txn.nonParticipation &&\n      (txn.voteKey ||\n        txn.selectionKey ||\n        txn.stateProofKey ||\n        txn.voteFirst ||\n        txn.voteLast ||\n        txn.voteKeyDilution) &&\n      !(\n        txn.voteKey &&\n        txn.selectionKey &&\n        txn.voteFirst &&\n        txn.voteLast &&\n        txn.voteKeyDilution\n      )\n      // stateProofKey not included here for backwards compatibility\n    ) {\n      throw new Error(\n        'online key registration missing at least one of the following fields: ' +\n          'voteKey, selectionKey, voteFirst, voteLast, voteKeyDilution'\n      );\n    }\n    // The last option is an offline key registration where all the fields\n    // nonParticipation, voteKey, selectionKey, voteFirst, voteLast, voteKeyDilution\n    // are all undefined/false\n\n    // Remove unwanted properties and store transaction on instance\n    delete ((txn as unknown) as AnyTransactionWithParams).suggestedParams;\n    Object.assign(this, utils.removeUndefinedProperties(txn));\n\n    // Modify Fee\n    if (!txn.flatFee) {\n      this.fee *= this.estimateSize();\n      // If suggested fee too small and will be rejected, set to min tx fee\n      if (this.fee < ALGORAND_MIN_TX_FEE) {\n        this.fee = ALGORAND_MIN_TX_FEE;\n      }\n    }\n\n    // say we are aware of groups\n    this.group = undefined;\n\n    // stpf fields\n    if (\n      txn.stateProofType !== undefined &&\n      (!Number.isSafeInteger(txn.stateProofType) || txn.stateProofType < 0)\n    )\n      throw Error(\n        'State Proof type must be a positive number and smaller than 2^53-1'\n      );\n    if (txn.stateProofMessage !== undefined) {\n      if (txn.stateProofMessage.constructor !== Uint8Array)\n        throw Error('stateProofMessage must be a Uint8Array.');\n    } else {\n      txn.stateProofMessage = new Uint8Array(0);\n    }\n    if (txn.stateProof !== undefined) {\n      if (txn.stateProof.constructor !== Uint8Array)\n        throw Error('stateProof must be a Uint8Array.');\n    } else {\n      txn.stateProof = new Uint8Array(0);\n    }\n  }\n\n  // eslint-disable-next-line camelcase\n  get_obj_for_encoding() {\n    if (this.type === 'pay') {\n      const txn: EncodedTransaction = {\n        amt: this.amount,\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: 'pay',\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n      };\n\n      // parse close address\n      if (\n        this.closeRemainderTo !== undefined &&\n        address.encodeAddress(this.closeRemainderTo.publicKey) !==\n          address.ALGORAND_ZERO_ADDRESS_STRING\n      ) {\n        txn.close = Buffer.from(this.closeRemainderTo.publicKey);\n      }\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      // allowed zero values\n      if (this.to !== undefined) txn.rcv = Buffer.from(this.to.publicKey);\n      if (!txn.note.length) delete txn.note;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (txn.grp === undefined) delete txn.grp;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.rekey) delete txn.rekey;\n      return txn;\n    }\n    if (this.type === 'keyreg') {\n      const txn: EncodedTransaction = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        votekey: this.voteKey,\n        selkey: this.selectionKey,\n        sprfkey: this.stateProofKey,\n        votefst: this.voteFirst,\n        votelst: this.voteLast,\n        votekd: this.voteKeyDilution,\n      };\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (txn.grp === undefined) delete txn.grp;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      if (this.nonParticipation) {\n        txn.nonpart = true;\n      }\n      if (!txn.selkey) delete txn.selkey;\n      if (!txn.votekey) delete txn.votekey;\n      if (!txn.sprfkey) delete txn.sprfkey;\n      if (!txn.votefst) delete txn.votefst;\n      if (!txn.votelst) delete txn.votelst;\n      if (!txn.votekd) delete txn.votekd;\n      return txn;\n    }\n    if (this.type === 'acfg') {\n      // asset creation, or asset reconfigure, or asset destruction\n      const txn: EncodedTransaction = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        caid: this.assetIndex,\n        apar: {\n          t: this.assetTotal,\n          df: this.assetDefaultFrozen,\n          dc: this.assetDecimals,\n        },\n      };\n      if (this.assetManager !== undefined)\n        txn.apar.m = Buffer.from(this.assetManager.publicKey);\n      if (this.assetReserve !== undefined)\n        txn.apar.r = Buffer.from(this.assetReserve.publicKey);\n      if (this.assetFreeze !== undefined)\n        txn.apar.f = Buffer.from(this.assetFreeze.publicKey);\n      if (this.assetClawback !== undefined)\n        txn.apar.c = Buffer.from(this.assetClawback.publicKey);\n      if (this.assetName !== undefined) txn.apar.an = this.assetName;\n      if (this.assetUnitName !== undefined) txn.apar.un = this.assetUnitName;\n      if (this.assetURL !== undefined) txn.apar.au = this.assetURL;\n      if (this.assetMetadataHash !== undefined)\n        txn.apar.am = Buffer.from(this.assetMetadataHash);\n\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n\n      if (!txn.caid) delete txn.caid;\n      if (\n        !txn.apar.t &&\n        !txn.apar.un &&\n        !txn.apar.an &&\n        !txn.apar.df &&\n        !txn.apar.m &&\n        !txn.apar.r &&\n        !txn.apar.f &&\n        !txn.apar.c &&\n        !txn.apar.au &&\n        !txn.apar.am &&\n        !txn.apar.dc\n      ) {\n        delete txn.apar;\n      } else {\n        if (!txn.apar.t) delete txn.apar.t;\n        if (!txn.apar.dc) delete txn.apar.dc;\n        if (!txn.apar.un) delete txn.apar.un;\n        if (!txn.apar.an) delete txn.apar.an;\n        if (!txn.apar.df) delete txn.apar.df;\n        if (!txn.apar.m) delete txn.apar.m;\n        if (!txn.apar.r) delete txn.apar.r;\n        if (!txn.apar.f) delete txn.apar.f;\n        if (!txn.apar.c) delete txn.apar.c;\n        if (!txn.apar.au) delete txn.apar.au;\n        if (!txn.apar.am) delete txn.apar.am;\n      }\n      if (txn.grp === undefined) delete txn.grp;\n\n      return txn;\n    }\n    if (this.type === 'axfer') {\n      // asset transfer, acceptance, revocation, mint, or burn\n      const txn: EncodedTransaction = {\n        aamt: this.amount,\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        arcv: Buffer.from(this.to.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        xaid: this.assetIndex,\n      };\n      if (this.closeRemainderTo !== undefined)\n        txn.aclose = Buffer.from(this.closeRemainderTo.publicKey);\n      if (this.assetRevocationTarget !== undefined)\n        txn.asnd = Buffer.from(this.assetRevocationTarget.publicKey);\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.aamt) delete txn.aamt;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (txn.grp === undefined) delete txn.grp;\n      if (!txn.aclose) delete txn.aclose;\n      if (!txn.asnd) delete txn.asnd;\n      if (!txn.rekey) delete txn.rekey;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      return txn;\n    }\n    if (this.type === 'afrz') {\n      // asset freeze or unfreeze\n      const txn: EncodedTransaction = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        faid: this.assetIndex,\n        afrz: this.freezeState,\n      };\n      if (this.freezeAccount !== undefined)\n        txn.fadd = Buffer.from(this.freezeAccount.publicKey);\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (!txn.afrz) delete txn.afrz;\n      if (txn.grp === undefined) delete txn.grp;\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      return txn;\n    }\n    if (this.type === 'appl') {\n      // application call of some kind\n      const txn: EncodedTransaction = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        grp: this.group,\n        apid: this.appIndex,\n        apan: this.appOnComplete,\n        apls: {\n          nui: this.appLocalInts,\n          nbs: this.appLocalByteSlices,\n        },\n        apgs: {\n          nui: this.appGlobalInts,\n          nbs: this.appGlobalByteSlices,\n        },\n        apfa: this.appForeignApps,\n        apas: this.appForeignAssets,\n        apep: this.extraPages,\n        apbx: translateBoxReferences(\n          this.boxes,\n          this.appForeignApps,\n          this.appIndex\n        ),\n      };\n      if (this.reKeyTo !== undefined) {\n        txn.rekey = Buffer.from(this.reKeyTo.publicKey);\n      }\n      if (this.appApprovalProgram !== undefined) {\n        txn.apap = Buffer.from(this.appApprovalProgram);\n      }\n      if (this.appClearProgram !== undefined) {\n        txn.apsu = Buffer.from(this.appClearProgram);\n      }\n      if (this.appArgs !== undefined) {\n        txn.apaa = this.appArgs.map((arg) => Buffer.from(arg));\n      }\n      if (this.appAccounts !== undefined) {\n        txn.apat = this.appAccounts.map((decodedAddress) =>\n          Buffer.from(decodedAddress.publicKey)\n        );\n      }\n      // allowed zero values\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (!txn.apid) delete txn.apid;\n      if (!txn.apls.nui) delete txn.apls.nui;\n      if (!txn.apls.nbs) delete txn.apls.nbs;\n      if (!txn.apls.nui && !txn.apls.nbs) delete txn.apls;\n      if (!txn.apgs.nui) delete txn.apgs.nui;\n      if (!txn.apgs.nbs) delete txn.apgs.nbs;\n      if (!txn.apaa || !txn.apaa.length) delete txn.apaa;\n      if (!txn.apgs.nui && !txn.apgs.nbs) delete txn.apgs;\n      if (!txn.apap) delete txn.apap;\n      if (!txn.apsu) delete txn.apsu;\n      if (!txn.apan) delete txn.apan;\n      if (!txn.apfa || !txn.apfa.length) delete txn.apfa;\n      if (!txn.apas || !txn.apas.length) delete txn.apas;\n      for (const box of txn.apbx) {\n        if (!box.i) delete box.i;\n        if (!box.n || !box.n.length) delete box.n;\n      }\n      if (!txn.apbx || !txn.apbx.length) delete txn.apbx;\n      if (!txn.apat || !txn.apat.length) delete txn.apat;\n      if (!txn.apep) delete txn.apep;\n      if (txn.grp === undefined) delete txn.grp;\n      return txn;\n    }\n    if (this.type === 'stpf') {\n      // state proof txn\n      const txn: EncodedTransaction = {\n        fee: this.fee,\n        fv: this.firstRound,\n        lv: this.lastRound,\n        note: Buffer.from(this.note),\n        snd: Buffer.from(this.from.publicKey),\n        type: this.type,\n        gen: this.genesisID,\n        gh: this.genesisHash,\n        lx: Buffer.from(this.lease),\n        sptype: this.stateProofType,\n        spmsg: Buffer.from(this.stateProofMessage),\n        sp: Buffer.from(this.stateProof),\n      };\n      // allowed zero values\n      if (!txn.sptype) delete txn.sptype;\n      if (!txn.note.length) delete txn.note;\n      if (!txn.lx.length) delete txn.lx;\n      if (!txn.amt) delete txn.amt;\n      if (!txn.fee) delete txn.fee;\n      if (!txn.fv) delete txn.fv;\n      if (!txn.gen) delete txn.gen;\n      if (!txn.apid) delete txn.apid;\n      if (!txn.apaa || !txn.apaa.length) delete txn.apaa;\n      if (!txn.apap) delete txn.apap;\n      if (!txn.apsu) delete txn.apsu;\n      if (!txn.apan) delete txn.apan;\n      if (!txn.apfa || !txn.apfa.length) delete txn.apfa;\n      if (!txn.apas || !txn.apas.length) delete txn.apas;\n      if (!txn.apat || !txn.apat.length) delete txn.apat;\n      if (!txn.apep) delete txn.apep;\n      if (txn.grp === undefined) delete txn.grp;\n      return txn;\n    }\n\n    return undefined;\n  }\n\n  // eslint-disable-next-line camelcase\n  static from_obj_for_encoding(txnForEnc: EncodedTransaction): Transaction {\n    const txn = Object.create(this.prototype) as Transaction;\n    txn.name = 'Transaction';\n    txn.tag = Buffer.from('TX');\n\n    txn.genesisID = txnForEnc.gen;\n    txn.genesisHash = Buffer.from(txnForEnc.gh);\n    if (!isTransactionType(txnForEnc.type)) {\n      throw new Error(`Unrecognized transaction type: ${txnForEnc.type}`);\n    }\n    txn.type = txnForEnc.type;\n    txn.fee = txnForEnc.fee;\n    txn.firstRound = txnForEnc.fv;\n    txn.lastRound = txnForEnc.lv;\n    txn.note = new Uint8Array(txnForEnc.note);\n    txn.lease = new Uint8Array(txnForEnc.lx);\n    txn.from = address.decodeAddress(\n      address.encodeAddress(new Uint8Array(txnForEnc.snd))\n    );\n    if (txnForEnc.grp !== undefined) txn.group = Buffer.from(txnForEnc.grp);\n    if (txnForEnc.rekey !== undefined)\n      txn.reKeyTo = address.decodeAddress(\n        address.encodeAddress(new Uint8Array(txnForEnc.rekey))\n      );\n\n    if (txnForEnc.type === 'pay') {\n      txn.amount = txnForEnc.amt;\n      txn.to = address.decodeAddress(\n        address.encodeAddress(new Uint8Array(txnForEnc.rcv))\n      );\n      if (txnForEnc.close !== undefined)\n        txn.closeRemainderTo = address.decodeAddress(\n          address.encodeAddress(txnForEnc.close)\n        );\n    } else if (txnForEnc.type === 'keyreg') {\n      if (txnForEnc.votekey !== undefined) {\n        txn.voteKey = Buffer.from(txnForEnc.votekey);\n      }\n      if (txnForEnc.selkey !== undefined) {\n        txn.selectionKey = Buffer.from(txnForEnc.selkey);\n      }\n      if (txnForEnc.sprfkey !== undefined) {\n        txn.stateProofKey = Buffer.from(txnForEnc.sprfkey);\n      }\n      if (txnForEnc.votekd !== undefined) {\n        txn.voteKeyDilution = txnForEnc.votekd;\n      }\n      if (txnForEnc.votefst !== undefined) {\n        txn.voteFirst = txnForEnc.votefst;\n      }\n      if (txnForEnc.votelst !== undefined) {\n        txn.voteLast = txnForEnc.votelst;\n      }\n      if (txnForEnc.nonpart !== undefined) {\n        txn.nonParticipation = txnForEnc.nonpart;\n      }\n    } else if (txnForEnc.type === 'acfg') {\n      // asset creation, or asset reconfigure, or asset destruction\n      if (txnForEnc.caid !== undefined) {\n        txn.assetIndex = txnForEnc.caid;\n      }\n      if (txnForEnc.apar !== undefined) {\n        txn.assetTotal = txnForEnc.apar.t;\n        txn.assetDefaultFrozen = txnForEnc.apar.df;\n        if (txnForEnc.apar.dc !== undefined)\n          txn.assetDecimals = txnForEnc.apar.dc;\n        if (txnForEnc.apar.m !== undefined)\n          txn.assetManager = address.decodeAddress(\n            address.encodeAddress(new Uint8Array(txnForEnc.apar.m))\n          );\n        if (txnForEnc.apar.r !== undefined)\n          txn.assetReserve = address.decodeAddress(\n            address.encodeAddress(new Uint8Array(txnForEnc.apar.r))\n          );\n        if (txnForEnc.apar.f !== undefined)\n          txn.assetFreeze = address.decodeAddress(\n            address.encodeAddress(new Uint8Array(txnForEnc.apar.f))\n          );\n        if (txnForEnc.apar.c !== undefined)\n          txn.assetClawback = address.decodeAddress(\n            address.encodeAddress(new Uint8Array(txnForEnc.apar.c))\n          );\n        if (txnForEnc.apar.un !== undefined)\n          txn.assetUnitName = txnForEnc.apar.un;\n        if (txnForEnc.apar.an !== undefined) txn.assetName = txnForEnc.apar.an;\n        if (txnForEnc.apar.au !== undefined) txn.assetURL = txnForEnc.apar.au;\n        if (txnForEnc.apar.am !== undefined)\n          txn.assetMetadataHash = txnForEnc.apar.am;\n      }\n    } else if (txnForEnc.type === 'axfer') {\n      // asset transfer, acceptance, revocation, mint, or burn\n      if (txnForEnc.xaid !== undefined) {\n        txn.assetIndex = txnForEnc.xaid;\n      }\n      if (txnForEnc.aamt !== undefined) txn.amount = txnForEnc.aamt;\n      if (txnForEnc.aclose !== undefined) {\n        txn.closeRemainderTo = address.decodeAddress(\n          address.encodeAddress(new Uint8Array(txnForEnc.aclose))\n        );\n      }\n      if (txnForEnc.asnd !== undefined) {\n        txn.assetRevocationTarget = address.decodeAddress(\n          address.encodeAddress(new Uint8Array(txnForEnc.asnd))\n        );\n      }\n      txn.to = address.decodeAddress(\n        address.encodeAddress(new Uint8Array(txnForEnc.arcv))\n      );\n    } else if (txnForEnc.type === 'afrz') {\n      if (txnForEnc.afrz !== undefined) {\n        txn.freezeState = txnForEnc.afrz;\n      }\n      if (txnForEnc.faid !== undefined) {\n        txn.assetIndex = txnForEnc.faid;\n      }\n      txn.freezeAccount = address.decodeAddress(\n        address.encodeAddress(new Uint8Array(txnForEnc.fadd))\n      );\n    } else if (txnForEnc.type === 'appl') {\n      if (txnForEnc.apid !== undefined) {\n        txn.appIndex = txnForEnc.apid;\n      }\n      if (txnForEnc.apan !== undefined) {\n        txn.appOnComplete = txnForEnc.apan;\n      }\n      if (txnForEnc.apls !== undefined) {\n        if (txnForEnc.apls.nui !== undefined)\n          txn.appLocalInts = txnForEnc.apls.nui;\n        if (txnForEnc.apls.nbs !== undefined)\n          txn.appLocalByteSlices = txnForEnc.apls.nbs;\n      }\n      if (txnForEnc.apgs !== undefined) {\n        if (txnForEnc.apgs.nui !== undefined)\n          txn.appGlobalInts = txnForEnc.apgs.nui;\n        if (txnForEnc.apgs.nbs !== undefined)\n          txn.appGlobalByteSlices = txnForEnc.apgs.nbs;\n      }\n      if (txnForEnc.apep !== undefined) {\n        txn.extraPages = txnForEnc.apep;\n      }\n      if (txnForEnc.apap !== undefined) {\n        txn.appApprovalProgram = new Uint8Array(txnForEnc.apap);\n      }\n      if (txnForEnc.apsu !== undefined) {\n        txn.appClearProgram = new Uint8Array(txnForEnc.apsu);\n      }\n      if (txnForEnc.apaa !== undefined) {\n        txn.appArgs = txnForEnc.apaa.map((arg) => new Uint8Array(arg));\n      }\n      if (txnForEnc.apat !== undefined) {\n        txn.appAccounts = txnForEnc.apat.map((addressBytes) =>\n          address.decodeAddress(\n            address.encodeAddress(new Uint8Array(addressBytes))\n          )\n        );\n      }\n      if (txnForEnc.apfa !== undefined) {\n        txn.appForeignApps = txnForEnc.apfa;\n      }\n      if (txnForEnc.apas !== undefined) {\n        txn.appForeignAssets = txnForEnc.apas;\n      }\n      if (txnForEnc.apbx !== undefined) {\n        txn.boxes = txnForEnc.apbx.map((box) => ({\n          // We return 0 for the app ID so that it's guaranteed translateBoxReferences will\n          // translate the app index back to 0. If we instead returned the called app ID,\n          // translateBoxReferences would translate the app index to a nonzero value if the called\n          // app is also in the foreign app array.\n          appIndex: box.i ? txn.appForeignApps[box.i - 1] : 0,\n          name: box.n,\n        }));\n      }\n    } else if (txnForEnc.type === 'stpf') {\n      if (txnForEnc.sptype !== undefined) {\n        txn.stateProofType = txnForEnc.sptype;\n      }\n      if (txnForEnc.sp !== undefined) {\n        txn.stateProof = txnForEnc.sp;\n      }\n      if (txnForEnc.spmsg !== undefined) {\n        txn.stateProofMessage = txnForEnc.spmsg;\n      }\n    }\n    return txn;\n  }\n\n  estimateSize() {\n    return this.toByte().length + NUM_ADDL_BYTES_AFTER_SIGNING;\n  }\n\n  bytesToSign() {\n    const encodedMsg = this.toByte();\n    return Buffer.from(utils.concatArrays(this.tag, encodedMsg));\n  }\n\n  toByte() {\n    return encoding.encode(this.get_obj_for_encoding());\n  }\n\n  // returns the raw signature\n  rawSignTxn(sk: Uint8Array) {\n    const toBeSigned = this.bytesToSign();\n    const sig = nacl.sign(toBeSigned, sk);\n    return Buffer.from(sig);\n  }\n\n  signTxn(sk: Uint8Array) {\n    // construct signed message\n    const sTxn: EncodedSignedTransaction = {\n      sig: this.rawSignTxn(sk),\n      txn: this.get_obj_for_encoding(),\n    };\n    // add AuthAddr if signing with a different key than From indicates\n    const keypair = nacl.keyPairFromSecretKey(sk);\n    const pubKeyFromSk = keypair.publicKey;\n    if (\n      address.encodeAddress(pubKeyFromSk) !==\n      address.encodeAddress(this.from.publicKey)\n    ) {\n      sTxn.sgnr = Buffer.from(pubKeyFromSk);\n    }\n    return new Uint8Array(encoding.encode(sTxn));\n  }\n\n  attachSignature(signerAddr: string, signature: Uint8Array) {\n    if (!nacl.isValidSignatureLength(signature.length)) {\n      throw new Error('Invalid signature length');\n    }\n    const sTxn: EncodedSignedTransaction = {\n      sig: Buffer.from(signature),\n      txn: this.get_obj_for_encoding(),\n    };\n    // add AuthAddr if signing with a different key than From indicates\n    if (signerAddr !== address.encodeAddress(this.from.publicKey)) {\n      const signerPublicKey = address.decodeAddress(signerAddr).publicKey;\n      sTxn.sgnr = Buffer.from(signerPublicKey);\n    }\n    return new Uint8Array(encoding.encode(sTxn));\n  }\n\n  rawTxID() {\n    const enMsg = this.toByte();\n    const gh = Buffer.from(utils.concatArrays(this.tag, enMsg));\n    return Buffer.from(nacl.genericHash(gh));\n  }\n\n  txID() {\n    const hash = this.rawTxID();\n    return base32.encode(hash).slice(0, ALGORAND_TRANSACTION_LENGTH);\n  }\n\n  // add a lease to a transaction not yet having\n  // supply feePerByte to increment fee accordingly\n  addLease(lease: Uint8Array, feePerByte = 0) {\n    let mutableLease: Uint8Array;\n\n    if (lease !== undefined) {\n      if (lease.constructor !== Uint8Array)\n        throw Error('lease must be a Uint8Array.');\n      if (lease.length !== ALGORAND_TRANSACTION_LEASE_LENGTH)\n        throw Error(\n          `lease must be of length ${ALGORAND_TRANSACTION_LEASE_LENGTH.toString()}.`\n        );\n\n      mutableLease = new Uint8Array(lease);\n    } else {\n      mutableLease = new Uint8Array(0);\n    }\n    this.lease = mutableLease;\n    if (feePerByte !== 0) {\n      this.fee +=\n        (ALGORAND_TRANSACTION_LEASE_LABEL_LENGTH +\n          ALGORAND_TRANSACTION_LEASE_LENGTH) *\n        feePerByte;\n    }\n  }\n\n  // add the rekey-to field to a transaction not yet having it\n  // supply feePerByte to increment fee accordingly\n  addRekey(reKeyTo: string, feePerByte = 0) {\n    if (reKeyTo !== undefined) {\n      this.reKeyTo = address.decodeAddress(reKeyTo);\n    }\n    if (feePerByte !== 0) {\n      this.fee +=\n        (ALGORAND_TRANSACTION_REKEY_LABEL_LENGTH +\n          ALGORAND_TRANSACTION_ADDRESS_LENGTH) *\n        feePerByte;\n    }\n  }\n\n  // build display dict for prettyPrint and toString\n  // eslint-disable-next-line no-underscore-dangle\n  _getDictForDisplay() {\n    const forPrinting: TransactionStorageStructure & Record<string, any> = {\n      ...this,\n    };\n    forPrinting.tag = forPrinting.tag.toString();\n    forPrinting.from = address.encodeAddress(\n      (forPrinting.from as Address).publicKey\n    );\n    if (forPrinting.to !== undefined)\n      forPrinting.to = address.encodeAddress(\n        (forPrinting.to as Address).publicKey\n      );\n    // things that need fixing:\n    if (forPrinting.freezeAccount !== undefined)\n      forPrinting.freezeAccount = address.encodeAddress(\n        (forPrinting.freezeAccount as Address).publicKey\n      );\n    if (forPrinting.closeRemainderTo !== undefined)\n      forPrinting.closeRemainderTo = address.encodeAddress(\n        (forPrinting.closeRemainderTo as Address).publicKey\n      );\n    if (forPrinting.assetManager !== undefined)\n      forPrinting.assetManager = address.encodeAddress(\n        (forPrinting.assetManager as Address).publicKey\n      );\n    if (forPrinting.assetReserve !== undefined)\n      forPrinting.assetReserve = address.encodeAddress(\n        (forPrinting.assetReserve as Address).publicKey\n      );\n    if (forPrinting.assetFreeze !== undefined)\n      forPrinting.assetFreeze = address.encodeAddress(\n        (forPrinting.assetFreeze as Address).publicKey\n      );\n    if (forPrinting.assetClawback !== undefined)\n      forPrinting.assetClawback = address.encodeAddress(\n        (forPrinting.assetClawback as Address).publicKey\n      );\n    if (forPrinting.assetRevocationTarget !== undefined)\n      forPrinting.assetRevocationTarget = address.encodeAddress(\n        (forPrinting.assetRevocationTarget as Address).publicKey\n      );\n    if (forPrinting.reKeyTo !== undefined)\n      forPrinting.reKeyTo = address.encodeAddress(\n        (forPrinting.reKeyTo as Address).publicKey\n      );\n    forPrinting.genesisHash = forPrinting.genesisHash.toString('base64');\n    return forPrinting;\n  }\n\n  // pretty print the transaction to console\n  prettyPrint() {\n    // eslint-disable-next-line no-underscore-dangle,no-console\n    console.log(this._getDictForDisplay());\n  }\n\n  // get string representation\n  toString() {\n    // eslint-disable-next-line no-underscore-dangle\n    return JSON.stringify(this._getDictForDisplay());\n  }\n}\n\n/**\n * encodeUnsignedSimulateTransaction takes a txnBuilder.Transaction object,\n * converts it into a SignedTransaction-like object, and converts it to a Buffer.\n *\n * Note: this function should only be used to simulate unsigned transactions.\n *\n * @param transactionObject - Transaction object to simulate.\n */\nexport function encodeUnsignedSimulateTransaction(\n  transactionObject: Transaction\n) {\n  const objToEncode: EncodedSignedTransaction = {\n    sig: null,\n    txn: transactionObject.get_obj_for_encoding(),\n  };\n  return encoding.rawEncode(objToEncode);\n}\n\n/**\n * encodeUnsignedTransaction takes a completed txnBuilder.Transaction object, such as from the makeFoo\n * family of transactions, and converts it to a Buffer\n * @param transactionObject - the completed Transaction object\n */\nexport function encodeUnsignedTransaction(transactionObject: Transaction) {\n  const objToEncode = transactionObject.get_obj_for_encoding();\n  return encoding.encode(objToEncode);\n}\n\n/**\n * decodeUnsignedTransaction takes a Buffer (as if from encodeUnsignedTransaction) and converts it to a txnBuilder.Transaction object\n * @param transactionBuffer - the Uint8Array containing a transaction\n */\nexport function decodeUnsignedTransaction(\n  transactionBuffer: ArrayLike<number>\n) {\n  const partlyDecodedObject = encoding.decode(\n    transactionBuffer\n  ) as EncodedTransaction;\n  return Transaction.from_obj_for_encoding(partlyDecodedObject);\n}\n\n/**\n * Object representing a transaction with a signature\n */\nexport interface SignedTransaction {\n  /**\n   * Transaction signature\n   */\n  sig?: Buffer;\n\n  /**\n   * The transaction that was signed\n   */\n  txn: Transaction;\n\n  /**\n   * Multisig structure\n   */\n  msig?: EncodedMultisig;\n\n  /**\n   * Logic signature\n   */\n  lsig?: EncodedLogicSig;\n\n  /**\n   * The signer, if signing with a different key than the Transaction type `from` property indicates\n   */\n  sgnr?: Buffer;\n}\n\n/**\n * decodeSignedTransaction takes a Buffer (from transaction.signTxn) and converts it to an object\n * containing the Transaction (txn), the signature (sig), and the auth-addr field if applicable (sgnr)\n * @param transactionBuffer - the Uint8Array containing a transaction\n * @returns containing a Transaction, the signature, and possibly an auth-addr field\n */\nexport function decodeSignedTransaction(\n  transactionBuffer: Uint8Array\n): SignedTransaction {\n  const stxnDecoded = encoding.decode(\n    transactionBuffer\n  ) as EncodedSignedTransaction;\n  const stxn: SignedTransaction = {\n    ...stxnDecoded,\n    txn: Transaction.from_obj_for_encoding(stxnDecoded.txn),\n  };\n  return stxn;\n}\n\n/**\n * Either a valid transaction object or an instance of the Transaction class\n */\nexport type TransactionLike = AnyTransaction | Transaction;\n\nexport function instantiateTxnIfNeeded(transactionLike: TransactionLike) {\n  return transactionLike instanceof Transaction\n    ? transactionLike\n    : new Transaction(transactionLike);\n}\n\nexport default Transaction;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}